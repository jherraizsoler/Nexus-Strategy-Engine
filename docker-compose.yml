services:
  nexus-backend:
    build: 
      context: ./backend 
      dockerfile: Dockerfile
    container_name: nexus_strategy_backend
    ports:
      - "8000:8000"
    env_file:
      - ./backend/.env 
    environment:
      # Inyecta la raíz del proyecto para asegurar que las importaciones de módulos (agents, state) sean absolutas y consistentes.
      - PYTHONPATH=/app
      # Define la ubicación persistente de la base de datos SQLite para la gestión de hilos/memoria de LangGraph.
      - DATABASE_PATH=/app/data/nexus_strategy.db
    volumes:
      # Bind-mounting para desarrollo: Sincroniza el código fuente para Hot-Reload sin reconstruir la imagen.
      - ./backend:/app/backend
      # Persistencia de datos: Garantiza que la base de datos de hilos de la IA sobreviva al reinicio del contenedor.
      - ./backend/data:/app/backend/data
    restart: always

  frontend:
    build: ./frontend
    container_name: nexus_strategy_frontend
    ports:
      - "4200:4200"
    volumes:
      # Sincronización en tiempo real del dashboard en Angular 18 para agilizar el feedback visual de la UI.
      - ./frontend:/app
      # Volume shadowing: Evita que el montaje local sobrescriba las dependencias instaladas dentro del contenedor Linux.
      - /app/node_modules/
    environment:
      # Habilita el polling para el observador de archivos (Chokidar), necesario para detectar cambios en sistemas de archivos Windows.
      - CHOKIDAR_USEPOLLING=true
    depends_on:
      # Garantiza el orden de arranque: El orquestador de agentes debe estar disponible antes de que el dashboard intente conectar.
      - nexus-backend
